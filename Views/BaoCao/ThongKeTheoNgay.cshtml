@using Quanlicaan.Models.DTO;
@model IEnumerable<ThongKeTheoNgayModel>


@{
    ViewBag.Title = "Thống kê theo ngày";
    Layout = "~/Views/Shared/_Layout.cshtml";
}





<div class="container  p-lg-3 table-active border">

    <div class="text-md-center">
        @using (Html.BeginForm("ThongKeTheoNgay", "BaoCao", FormMethod.Get, new { id = "myForm" }))
        {
            <p> <b>THỐNG KÊ ĂN CA NGÀY: @Html.TextBox("date", DateTime.Now.ToString("yyyy-MM-dd"), new { type = "date", id = "date", onchange = "submitForm()" })</b></p>

        }
    </div>
    @{
        HashSet<string> dsPhongBanTmp = new HashSet<string>();
        foreach (var item in Model)
        {
            dsPhongBanTmp.Add(item.TenPhongBan);
        }
        List<string> dsPhongBan = new List<string>();
        dsPhongBan.AddRange(dsPhongBanTmp);
        <div class="ca">
            <p> <b>Ca 1:</b></p>
        </div>
        <div class="content">
            <table class="table table-striped table-hover border-bottom table-bordered ">
                <tr class="bg-primary">
                    <th class="text-md-center border-right">STT</th>
                    <th class="text-md-center border-right">Họ tên người đăng ký</th>
                    <th class="text-md-center border-right">Số lượng</th>
                    <th class="text-md-center border-right">Thành tiền</th>
                </tr>
                @for (int i = 0; i < dsPhongBan.Count(); i++)
                {

                    int flag = 0;

                    foreach (var item in Model)
                    {
                        if (item.TenPhongBan.Equals(dsPhongBan[i]) && item.IDCaAn == 1 && item.SoLuong != 0)
                        {
                            flag = 1;
                        }

                    }
                    if (flag == 1)
                    {
                        <tr>
                            <td class="text-md-center border-right table-warning"> Phòng: @dsPhongBan[i]  </td>
                            <td class="text-md-center border-right table-warning"></td>
                            <td class="text-md-center border-right table-warning"></td>
                            <td class="text-md-center border-right table-warning"> </td>
                        </tr>
                        int count = 1;
                        int TongSoLuong = 0;
                        long TongTien = 0;
                        foreach (var item in Model)
                        {
                            if (item.TenPhongBan.Equals(dsPhongBan[i]) && item.IDCaAn == 1 && item.SoLuong != 0)
                            {

                                <tr class="table-primary text-md-center border-bottom">
                                    <td class="font-weight-bold">@count  </td>
                                    <td> @item.TenNhanVien </td>
                                    <td> @item.SoLuong </td>
                                    @{var tmp = item.SoLuong * 15000;}
                                    <td> @tmp vnđ</td>
                                </tr>
                                count++;
                                TongSoLuong += item.SoLuong;
                                TongTien += tmp;
                            }
                        }

                        if (TongSoLuong != 0)
                        {
                            <tr>
                                <td class="text-md-center border-right table-success"></td>
                                <td class="text-md-center border-right table-success" style="text-align: center;"><b>Tổng</b></td>
                                <td class="text-md-center border-right table-success font-weight-bold">@TongSoLuong</td>
                                <td class="text-md-center border-right table-success font-weight-bold">@TongTien vnđ</td>
                            </tr>
                        }

                    }




                }
            </table>
        </div>
        <div class="ca">
            <p> <b>Ca 2:</b></p>
        </div>
        <div class="content">
            <table class="table table-striped table-hover border-bottom table-bordered ">
                <tr class="bg-primary">
                    <th class="text-md-center border-right">STT</th>
                    <th class="text-md-center border-right">Họ tên người đăng ký</th>
                    <th class="text-md-center border-right">Số lượng</th>
                    <th class="text-md-center border-right">Thành tiền</th>
                </tr>
                @for (int i = 0; i < dsPhongBan.Count(); i++)
                {

                    int flag = 0;

                    foreach (var item in Model)
                    {
                        if (item.TenPhongBan.Equals(dsPhongBan[i]) && item.IDCaAn == 2 && item.SoLuong != 0)
                        {
                            flag = 1;
                        }

                    }
                    if (flag == 1)
                    {
                        <tr>
                            <td class="text-md-center border-right table-warning"> Phòng: @dsPhongBan[i]  </td>
                            <td class="text-md-center border-right table-warning"></td>
                            <td class="text-md-center border-right table-warning"></td>
                            <td class="text-md-center border-right table-warning"> </td>
                        </tr>
                        int count = 1;
                        int TongSoLuong = 0;
                        long TongTien = 0;
                        foreach (var item in Model)
                        {
                            if (item.TenPhongBan.Equals(dsPhongBan[i]) && item.IDCaAn == 2 && item.SoLuong != 0)
                            {

                                <tr class="table-primary text-md-center border-bottom">
                                    <td class="font-weight-bold">@count  </td>
                                    <td> @item.TenNhanVien </td>
                                    <td> @item.SoLuong </td>
                                    @{var tmp = item.SoLuong * 15000;}
                                    <td> @tmp vnđ</td>
                                </tr>
                                count++;
                                TongSoLuong += item.SoLuong;
                                TongTien += tmp;
                            }
                        }

                        if (TongSoLuong != 0)
                        {
                            <tr>
                                <td class="text-md-center border-right table-success"></td>
                                <td class="text-md-center border-right table-success" style="text-align: center;"><b>Tổng</b></td>
                                <td class="text-md-center border-right table-success font-weight-bold">@TongSoLuong</td>
                                <td class="text-md-center border-right table-success font-weight-bold">@TongTien vnđ</td>
                            </tr>
                        }

                    }




                }
            </table>
        </div>
        <div class="ca">
            <p> <b>Ca 3:</b></p>
        </div>
        <div class="content">
            <table class="table table-striped table-hover border-bottom table-bordered ">
                <tr class="bg-primary">
                    <th class="text-md-center border-right">STT</th>
                    <th class="text-md-center border-right">Họ tên người đăng ký</th>
                    <th class="text-md-center border-right">Số lượng</th>
                    <th class="text-md-center border-right">Thành tiền</th>
                </tr>
                @for (int i = 0; i < dsPhongBan.Count(); i++)
                {

                    int flag = 0;

                    foreach (var item in Model)
                    {
                        if (item.TenPhongBan.Equals(dsPhongBan[i]) && item.IDCaAn == 3 && item.SoLuong != 0)
                        {
                            flag = 1;
                        }

                    }
                    if (flag == 1)
                    {
                        <tr>
                            <td class="text-md-center border-right table-warning"> Phòng: @dsPhongBan[i]  </td>
                            <td class="text-md-center border-right table-warning"></td>
                            <td class="text-md-center border-right table-warning"></td>
                            <td class="text-md-center border-right table-warning"> </td>
                        </tr>
                        int count = 1;
                        int TongSoLuong = 0;
                        long TongTien = 0;
                        foreach (var item in Model)
                        {
                            if (item.TenPhongBan.Equals(dsPhongBan[i]) && item.IDCaAn == 3 && item.SoLuong != 0)
                            {

                                <tr class="table-primary text-md-center border-bottom">
                                    <td class="font-weight-bold">@count  </td>
                                    <td> @item.TenNhanVien </td>
                                    <td> @item.SoLuong </td>
                                    @{var tmp = item.SoLuong * 15000;}
                                    <td> @tmp vnđ</td>
                                </tr>
                                count++;
                                TongSoLuong += item.SoLuong;
                                TongTien += tmp;
                            }
                        }

                        if (TongSoLuong != 0)
                        {
                            <tr>
                                <td class="text-md-center border-right table-success"></td>
                                <td class="text-md-center border-right table-success" style="text-align: center;"><b>Tổng</b></td>
                                <td class="text-md-center border-right table-success font-weight-bold">@TongSoLuong</td>
                                <td class="text-md-center border-right table-success font-weight-bold">@TongTien vnđ</td>
                            </tr>
                        }

                    }




                }
            </table>
        </div>


    }
</div>


<script type="text/javascript">
    function submitForm() {
        document.getElementById("myForm").submit();
    }
</script>





